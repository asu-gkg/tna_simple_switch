# Clos 拓扑物理连接指南

## 如何知道vm的哪个口对着哪根网线？拔了看看网口还在不在！

## 交换机端口分配

| 逻辑 Edge | 下行端口 (连主机) | 上行端口 (连 Spine) |
|-----------|------------------|---------------------|
| Edge 1    | **1/0**, **2/0** | 25/0, 26/0          |
| Edge 2    | **3/0**, **4/0** | 27/0, 28/0          |
| Edge 3    | 5/0, 6/0         | 29/0, 30/0          |
| Edge 4    | 7/0, 8/0         | 31/0, 32/0          |

## VM 物理连接映射

请按以下对应关系连接网线：

| VM 管理 IP     | 逻辑名 | 实验 IP     | MAC 地址           | 应连接端口 |
|----------------|--------|-------------|-------------------|-----------|
| 10.30.10.163   | h1     | 172.1.1.2   | b8:ce:f6:fd:0f:48 | **1/0**   |
| 10.30.9.188    | h2     | 172.1.1.3   | b8:ce:f6:fc:56:7e | **2/0**   |
| 10.30.11.134   | h3     | 172.2.1.2   | b8:ce:f6:f8:c8:7a | **3/0**   |
| 10.30.10.158   | h4     | 172.2.1.3   | b8:ce:f6:fd:10:88 | **4/0**   |
| 10.30.9.80     | h5     | 172.3.1.2   | b4:96:91:d4:fa:b0 | 5/0       |
| 10.30.9.169    | h6     | 172.3.1.3   | b4:96:91:d4:fa:b1 | 6/0       |
| 10.30.11.6     | h7     | 172.4.1.2   | b4:96:91:af:45:b8 | 7/0       |
| 10.30.11.122   | h8     | 172.4.1.3   | b4:96:91:af:45:b9 | 8/0       |

## 验证方法

调整后，在每台 VM 上运行：
```bash
sudo arping -I <实验网口> -c 5 <网关IP>
```

然后在交换机 `pm show` 查看对应端口的 FRAMES RX 是否增加。

| VM   | 发包命令                                              | 期望端口 RX 增加 |
|------|------------------------------------------------------|-----------------|
| h1   | `sudo arping -I enp6s17f0np0 -c 5 172.1.1.1`        | 1/0             |
| h2   | `sudo arping -I enp6s27f0np0 -c 5 172.1.1.1`        | 2/0             |
| h3   | `sudo arping -I <网口> -c 5 172.2.1.1`              | 3/0             |
| h4   | `sudo arping -I <网口> -c 5 172.2.1.1`              | 4/0             |

## 拓扑图

```
                    ┌─────────┐     ┌─────────┐
                    │ Spine 1 │     │ Spine 2 │
                    │ (逻辑)  │     │ (逻辑)  │
                    └────┬────┘     └────┬────┘
                         │               │
        ┌────────────────┼───────────────┼────────────────┐
        │                │               │                │
   ┌────┴────┐      ┌────┴────┐    ┌────┴────┐      ┌────┴────┐
   │ Edge 1  │      │ Edge 2  │    │ Edge 3  │      │ Edge 4  │
   │ P25,26  │      │ P27,28  │    │ P29,30  │      │ P31,32  │
   └─┬────┬──┘      └─┬────┬──┘    └─┬────┬──┘      └─┬────┬──┘
     │    │           │    │         │    │           │    │
   P1/0  P2/0       P3/0  P4/0     P5/0  P6/0       P7/0  P8/0
     │    │           │    │         │    │           │    │
    h1   h2          h3   h4        h5   h6          h7   h8
```
